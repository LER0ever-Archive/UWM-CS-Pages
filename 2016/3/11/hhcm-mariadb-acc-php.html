<!doctype html><head lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>HHVM&#43;MariaDB make PHP faster - L.E.R Space</title><meta name=format-detection content="telephone=no"><script>if(self!=top){top.location=this.location.href;}</script><meta name=keywords content="LER0ever,L.E.R,Yi Rong,blog,L.E.R Space,Lumos"><meta name=description content="Post on how to accelarate your php site"><link rel=icon href=/~rong/favicon.ico><link rel="shortcut icon" href=/~rong/favicon.ico><!--[if lt IE 9]>
    <script src="/js/html5.js" type="text/javascript"></script>
    <![endif]--><!--[if (gt IE 9)|!(IE)]>
    <script src="/js/jquery.mobile.customized.min.js" type="text/javascript"></script>
    <![endif]--><link rel=stylesheet id=font-style-css href=/~rong/css/fonts-google.css><link rel=stylesheet id=duena-bootstrap-css href=/~rong/bootstrap/css/bootstrap.css><link rel=stylesheet id=flexslider-css href=/~rong/css/magnific-popup.css><link rel=stylesheet id=magnific-css href=/~rong/css/flexslider.css><link rel=stylesheet id=font-awesome-css href=/~rong/css/font-awesome.css><link rel=stylesheet id=duena-style-css href=/~rong/css/style.css><link rel=stylesheet href=/~rong/css/hljs/monokai-sublime.css><style id=duena-style-inline-css>a,.searchform .screen-reader-text,.post_meta i,.author_bio_sidebar .social_box a,.post-title a:hover,.post-footer i,.page_nav_wrap .post_nav ul li .current,.page_nav_wrap .post_nav ul li a:hover{color:#ff5b5b}.post_type_label,.flex-direction-nav a,#content .featured_badge,.author_bio_sidebar .social_box,.flex-control-paging li a.flex-active,.flex-control-paging li a:hover,#toTop,.post-footer a,.navbar_inner>div>ul ul,.navbar_inner>ul ul,.btn.btn-primary,input[type=submit],input[type=reset]{background-color:#ff5b5b}.site-info,.widget,#slider-wrapper .flexslider,.navbar_inner>div>ul>li>a,.navbar_inner>div>ul>li>a:hover,.navbar_inner>div>ul>li.sfHover>a,.navbar_inner>div>ul>li.current-menu-item>a,.navbar_inner>div>ul>li.current_page_item>a,.navbar_inner>ul>li>a,.navbar_inner>ul>li>a:hover,.navbar_inner>ul>li.sfHover>a,.navbar_inner>ul>li.current-menu-item>a,.navbar_inner>ul>li.current_page_item>a,.breadcrumb,#comments,.post-footer a,.author-info{border-color:#ff5b5b}a:hover,a:focus{color:#71a08b}.btn.btn-primary:hover,input[type=submit]:hover,input[type=reset]:hover,.slider-caption .btn.btn-primary:hover{background-color:#71a08b}textarea:focus,input[type=text]:focus,input[type=password]:focus,input[type=datetime]:focus,input[type=datetime-local]:focus,input[type=date]:focus,input[type=month]:focus,input[type=time]:focus,input[type=week]:focus,input[type=number]:focus,input[type=email]:focus,input[type=url]:focus,input[type=search]:focus,input[type=tel]:focus,input[type=color]:focus,.uneditable-input:focus{border-color:#ff5b5b;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 2px #ff5b5b}</style><script src=/~rong/js/jquery-2.1.4.min.js></script><body class=post data-perma=hhcm-mariadb-acc-php><div class=page-wrapper><header id=header role=banner><div class="container clearfix"><div class=logo><h1 class=text-logo><a href=https://pages.cs.wisc.edu/~rong title="L.E.R Space" rel=home>L.E.R Space</a></h1><p class=site-description>@UW-Madison 沉着、淡定、超脱</div><div id=top-search><input name=s class=input-search placeholder="Click here or double-tap Alt to Search" id=searchbox><input type=submit id=submit></div><div class=clear></div><nav id=site-navigation class=main-nav role=navigation><div class=navbar_inner><ul id=topnav class=sf-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=/~rong>Home</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=/~rong/links>Links</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=/~rong/sn>Contact Me</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=/~rong/academic>Academics</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=/~rong/veta>My Magic</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=/~rong/archive>Archive</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://rongyi.ml target=_blank>中文网站</a></ul></div></nav></div></header><div id=main class=site-main><div class=container><ul class="breadcrumb breadcrumb__t"><li><a href=https://pages.cs.wisc.edu/~rong>Home</a><li class=divider>/<li class=active>HHVM&#43;MariaDB make PHP faster</ul><div class=row><div id=primary class="col-md-8 right"><div id=content class=site-content role=main><article id=post-1 class="post__holder post type-post status-publish format-standard hentry"><header class=post-header><h1 class=post-title>HHVM&#43;MariaDB make PHP faster</h1></header><div class=post_content><h4 id=this-post-is-still-under-translation-to-english>This post is still under translation to English</h4><p>HHVM是Facebook开源的PHP、Hack执行引擎，因为Facebook大多数的网页都是用PHP写的（包括Mark Zuckerburg在宿舍写的那部分），而PHP官方的zend又是效率极低。HHVM的Benchmark显示其效率比现在广泛使用的PHP5.x高5~10倍。搭配mariadb和nginx这两个轻量级的服务器软件，PHP网页的执行效率可能是用LAMP(Linux Apache2 MySQL PHP)搭建的网页高2~3倍，具体参照本网站的加载速度。<p>以下是教程</p><p>默认安装了Ubuntu 14.04LTS或以上版本，如果没有的话不保证成功，自行替换命令或Docker部署ubuntu镜像<p>首先安装Nginx，<pre class="lang:default decode:true">sudo apt-get update
sudo apt-get install nginx
service nginx restart</pre>至此，访问你的网站，如etasry.ml，将会看到<h1>Welcome to nginx!</h1>If you see this page, the nginx web server is successfully installed and working. Further configuration is required.<p>For online documentation and support please refer to <a href=http://nginx.org/>nginx.org</a><p>Please use the <tt>reportbug</tt> tool to report bugs in the nginx package with Debian. However, check <a href="http://bugs.debian.org/cgi-bin/pkgreport.cgi?ordering=normal;archive=0;src=nginx;repeatmerged=0">existing bug reports</a> before reporting a new bug.<p><em>Thank you for using nginx.</em><p>然后安装HipHop Virtual Machine<pre class="lang:default decode:true">sudo apt-get install autoconf automake binutils-dev build-essential cmake g++ gawk git
  libboost-dev libboost-filesystem-dev libboost-program-options-dev libboost-regex-dev
  libboost-system-dev libboost-thread-dev libboost-context-dev libbz2-dev libc-client-dev libldap2-dev
  libc-client2007e-dev libcap-dev libcurl4-openssl-dev libdwarf-dev libelf-dev
  libexpat-dev libgd2-xpm-dev libgoogle-glog-dev libgoogle-perftools-dev libicu-dev
  libjemalloc-dev libmcrypt-dev libmemcached-dev libmysqlclient-dev libncurses-dev
  libonig-dev libpcre3-dev libreadline-dev libtbb-dev libtool libxml2-dev zlib1g-dev
  libevent-dev libmagickwand-dev libinotifytools0-dev libiconv-hook-dev libedit-dev
  libiberty-dev libxslt1-dev ocaml-native-compilers libsqlite3-dev libyaml-dev libgmp3-dev
  gperf libkrb5-dev libnotify-dev</pre>安装完所有依赖项后，克隆源代码到本地<pre class="lang:default decode:true">git clone git://github.com/facebook/hhvm.git --depth=1
cd hhvm
git submodule update --init --recursive</pre>编译并安装，替换-J后面的数字为你的CPU数量<pre class="lang:default decode:true">cmake -DMYSQL_UNIX_SOCK_ADDR=/var/run/mysqld/mysqld.sock .
make -j [number_of_processor_cores] # eg. make -j 4
sudo make install</pre>二进制文件在/usr/local/bin/hhvm<p>随后执行/etc/hhvm/install-fastcgi.sh自动配置nginx，完成后你的nginx就会将PHP文件交给HHVM处理。<p>写个简单的脚本测试一下：<pre class="lang:default decode:true">&lt;?php
phpinfo();
?&gt;</pre>访问后如果你的HHVM执行这段代码的话应该返回HHVM Version 3.12.1<p>然而WordPress是不可以直接运行的，Nginx不负责解析.htaccess文件，所以Permalinks全部会挂，显示404或者403。<p>以下分享一个我的WordPress W3TotalCache的Nginx.conf，仅供语法参考<pre><code class=language-conf># BEGIN W3TC Page Cache cache
location ~ /wp-content/cache/page_enhanced.*html$ {
    add_header Vary &quot;Accept-Encoding, Cookie&quot;;
}
location ~ /wp-content/cache/page_enhanced.*gzip$ {
    gzip off;
    types {}
    default_type text/html;
    add_header Vary &quot;Accept-Encoding, Cookie&quot;;
    add_header Content-Encoding gzip;
}
# END W3TC Page Cache cache
# BEGIN W3TC Browser Cache
gzip on;
gzip_types text/css text/x-component application/x-javascript application/javascript text/javascript text/x-js text/richtext image/svg+xml text/plain text/xsd text/xsl text/xml image/x-icon;
# END W3TC Browser Cache
# BEGIN W3TC Page Cache core
set $w3tc_rewrite 1;
if ($request_method = POST) {
    set $w3tc_rewrite 0;
}
if ($query_string != &quot;&quot;) {
    set $w3tc_rewrite 0;
}
if ($http_cookie ~* &quot;(comment_author|wp-postpass|w3tc_logged_out|wordpress_logged_in|wptouch_switch_toggle)&quot;) {
    set $w3tc_rewrite 0;
}
if ($http_cookie ~* &quot;(w3tc_preview)&quot;) {
    set $w3tc_rewrite _preview;
}
set $w3tc_enc &quot;&quot;;
if ($http_accept_encoding ~ gzip) {
    set $w3tc_enc _gzip;
}
if (!-f &quot;$document_root/wp-content/cache/page_enhanced/$http_host/$request_uri/_index$w3tc_rewrite.html$w3tc_enc&quot;) {
  set $w3tc_rewrite 0;
}
if ($w3tc_rewrite = 1) {
    rewrite .* &quot;/wp-content/cache/page_enhanced/$http_host/$request_uri/_index$w3tc_rewrite.html$w3tc_enc&quot; last;
}
# END W3TC Page Cache core
</code></pre><p><span style=color:#000;font-family:simsun;font-size:32px;font-weight:700;line-height:normal;text-align:center> </span></div><div class="post_meta default"><i class="fa fa-tags"></i>Tags:</div><span class=post_type_label></span><span class=post_date><time>March 11, 2016</time></span><div class="post_meta default"><span class=post_category><a href=/category/Website.html rel="category tag">Website</a></span>
<span class=post_comment><i class="fa fa-comments"></i><a href class=comments-link>Comments are closed</a></span>
<span class=post_author><i class="fa fa-user"></i><a href=https://etasry.ml/author/l-e-r title="Posts by L.E.R" rel=author>L.E.R</a></span><div class=clear></div></div></article><div id=comments class=comments-area><div id=respond class=comment-respond><h3 id=reply-title class=comment-reply-title>Leave a Reply</h3><section id=comment><div class=row><div class="comment-body clearfix col-md-12"><div id=disqus_thread></div><script>(function(){var d=document,s=d.createElement('script');s.src='//l-e-r-space.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments
powered by Disqus.</a></noscript></div></div></section></div></div></div></div><div id=secondary class="widget-area col-md-4" role=complementary><div class=author_bio_sidebar><div class=social_box><a href=https://twitter.com/etasry><i class="fa fa-twitter"></i></a><a href=https://www.facebook.com/LER0ever><i class="fa fa-facebook"></i></a><a href=https://plus.google.com/110550757230711569932><i class="fa fa-google-plus"></i></a><a href><i class="fa fa-linkedin"></i></a><a href=/feed.xml><i class="fa fa-rss"></i></a></div><div class=content_box><h2>Welcome to my site</h2><div class=author_bio_message>Hello, and welcome to my site! I hope you like the place and decide to stay.</div><h6>This is the <a href=http://yirong.ml target=_blank>Global English Site</a><br>点击前往 <a href=http://rongyi.ml target=_blank>中文网站</a></h6></div></div><aside id=recent-posts-2 class="widget widget_recent_entries"><h3 class=widget-title>Recent</h3><ul><li><a href=/~rong/2016/9/3/lumos.html>HydroDev, Powerful DevPack</a><li><a href=/~rong/2016/8/5/welcome.html>About this New Site</a><li><a href=/~rong/2016/8/5/lumos.html>Lumos Static Site Generator</a><li><a href=/~rong/2016/3/11/alphago-intro-dl.html>AlphaGo Tech 2 - Deep Learning</a><li><a href=/~rong/2016/3/11/hhcm-mariadb-acc-php.html>HHVM&#43;MariaDB make PHP faster</a><li><a href=/~rong/2016/3/10/alphago-intro-mcts.html>AlphaGo Tech 1 - MCTS</a><li><a href=/~rong/2015/1/22/simple-cnn.html>Simple CNNs</a></ul></aside><aside id=categories-2 class="widget widget_categories"><h3 class=widget-title>Categories</h3><ul><li class=cat-item><a href=/category/Algorithms.html>Algorithms</a>(2)<li class=cat-item><a href=/category/Artificial%20Intelligence.html>Artificial Intelligence</a>(1)<li class=cat-item><a href=/category/Build%20System.html>Build System</a>(1)<li class=cat-item><a href=/category/Deep%20Learning.html>Deep Learning</a>(2)<li class=cat-item><a href=/category/Go.html>Go</a>(2)<li class=cat-item><a href=/category/Website.html>Website</a>(3)</ul></aside><aside id=tag_cloud-3 class="widget widget_tag_cloud"><h3 class=widget-title>Tags</h3><div class=tagcloud><a href=/tags/AlphaGo.html class="tag-link tag-link-position" style=font-size:8pt>AlphaGo</a>
<a href=/tags/CNNs.html class="tag-link tag-link-position" style=font-size:8pt>CNNs</a>
<a href=/tags/HydroDev.html class="tag-link tag-link-position" style=font-size:8pt>HydroDev</a>
<a href=/tags/Lumos.html class="tag-link tag-link-position" style=font-size:8pt>Lumos</a></div></aside></div></div></div></div></div><footer id=footer><div class="container text-center"><p><a href=https://creativecommons.org/licenses/by-nc-nd/4.0/>CC BY-NC-ND 4.0</a> |
<a href=/~rong/feed.xml>Feed</a> |
<a href=/~rong/sitemap.xml>Sitemap</a><p>Powered by <a href=http://github.com/LER0ever/Lumos>Lumos Engine 0.0.2 (alpha)</a></p><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-81922310-1','auto');ga('send','pageview');</script><script async src=//www.google-analytics.com/analytics.js></script></div></footer><div class=search-tool style=position:fixed;top:0;bottom:0;left:0;right:0;opacity:.95;background-color:#111;z-index:9999;display:none><input class="form-control search-content" id=search-content style=position:fixed;top:60px placeholder="文章标题 分类 标签 (L.E.R Space 站内搜索)"><div style=position:fixed;top:16px;right:16px><img src=/~rong/search/img/close.png id=close-btn></div></div><link rel=stylesheet href=/~rong/search/css/search.css><script src=/~rong/search/js/bootstrap3-typeahead.min.js></script><script src=/~rong/search/js/search.js></script><footer id=colophon class=site-footer role=contentinfo><div class=container><div class="site-info col-md-12"><div class=footer-text><b>Copyright © 2014-2016 L.E.R Space</b></div><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-81922310-1','auto');ga('send','pageview');</script><script async src=//www.google-analytics.com/analytics.js></script><div class=clear></div><div id=toTop><i class="fa fa-chevron-up"></i></div></div></div></footer><script src=/~rong/js/navigation.js></script><script src=/~rong/js/skip-link-focus-fix.js></script><script src=/~rong/js/superfish.js></script><script src=/~rong/js/jquery.mobilemenu.js></script><script src=/~rong/js/sfmenu-touch.js></script><script src=/~rong/js/jquery.flexslider.js></script><script src=/~rong/js/jquery.magnific-popup.js></script><script src=/~rong/js/bootstrap.js></script><script src=/~rong/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script src=/~rong/js/custom.js></script><script>jQuery(function(){jQuery('.navbar_inner > ul').superfish({delay:1000,animation:{opacity:"show",height:"show"},speed:'normal',autoArrows:false,dropShadows:false});jQuery('.navbar_inner > div > ul').superfish({delay:1000,animation:{opacity:"show",height:"show"},speed:'normal',autoArrows:false,dropShadows:false});});jQuery(function(){var ismobile=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i)
if(ismobile){jQuery('.navbar_inner > ul').sftouchscreen();jQuery('.navbar_inner > div > ul').sftouchscreen();}});</script><script>jQuery(function(){jQuery('.navbar_inner > ul').mobileMenu();jQuery('.navbar_inner > div > ul').mobileMenu();})</script><script>(function(){var request,b=document.body,c='className',cs='customize-support',rcs=new RegExp('(^|\\s+)(no-)?'+cs+'(\\s+|$)');request=true;b[c]=b[c].replace(rcs,' ');b[c]+=(window.postMessage&&request?' ':' no-')+cs;}());</script>